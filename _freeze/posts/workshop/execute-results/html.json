{
  "hash": "5ec1db651c7d87dfb03fcd0e69f17fbc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of Sample Restoration Data\"\ndescription: \"Practice with model fitting in my ENVS 193 DS class\"\nimage: rest_images/tidepools_day.png\ncategories: \n- restoration \nexecute:\n  message: false # use this to make sure messages don't show up\n  warning: false # use this to make sure warnings don't show up\n---\n\n\n\n**I am currently taking an Environmental Data Science class with An Bui. In workshop, we worked with [this data](https://doi.org/10.5061/dryad.v0861f7) to answer this question: How do specific leaf area, water treatment, and species influence plant mass? Results of this question can better inform restoration plans.**\n\nBelow is the completed workshop assignment, including code from r and it's output. \n\n**Specific leaf area** is a continuous variable measured in cm^2^/g.  \n\n**Water treatment** is a categorical variable (i.e. a *factor*) with 2 levels: drought stressed (DS) and well watered (WW).  \n\n**Species** is a categorical variable (again, a *factor*) with 6 levels.  \n\n| Species name                 | Species code | Common name        |\n|------------------------------|--------------|--------------------|\n| _Encelia californica_        | ENCCAL       | Bush sunflower     |  \n| _Eschsholzia californica_    | ESCCAL       | California poppy   | \n| _Penstemon centranthifolius_ | PENCEN       | Scarlet bugler     | \n| _Grindelia camporums_        | GRINCAM      | Gumweed            | \n| _Salvia leucophylla_         | SALLEU       | Purple sage        | \n| _Stipa pulchra_              | STIPUL       | Purple needlegrass | \n| _Lotus scoparius_            | LOTSCO       | Deerweed           |\n\n### 1. Setting up R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \nlibrary(here) \nlibrary(janitor) \nlibrary(readxl) \nlibrary(scales) \nlibrary(ggeffects) \nlibrary(MuMIn) \n\n# read in data\nlibrary(readxl)\ndrought_exp <- read_excel(\"Valliere_etal_EcoApps_Data copy.xlsx\")\n  # specifying which sheet you want to read in\n  sheet = \"First Harvest\"\n```\n:::\n\n\n\nStoring some colors to use in visualizations, and setting a common `ggplot` theme for all plots:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# storing colors to use for species\nlotsco_col <- \"#E69512\"\npencen_col <- \"#D6264F\"\nsalleu_col <- \"#6D397D\"\nenccal_col <- \"#3A5565\"\nstipul_col <- \"#3F564F\"\nesccal_col <- \"#515481\"\ngricam_col <- \"#6C91BD\"\n\n# storing colors to use for water treatments\nds_col <- \"#A62F03\"\nww_col <- \"#045CB4\"\n\n# storing a ggplot theme (that will be used for all ggplots)\ntheme_set(theme_bw())\n```\n:::\n\n\n\n\n### 2. Cleaning the raw data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating a clean data frame\ndrought_exp_clean <- drought_exp |> # starting with the drought_exp object\n  # cleaning column names\n  clean_names() |> \n  # making a column of full species names\n  mutate(species_name = case_match(\n    species,\n    \"ENCCAL\" ~ \"Encelia californica\", # bush sunflower\n    \"ESCCAL\" ~ \"Eschscholzia californica\", # California poppy\n    \"PENCEN\" ~ \"Penstemon centranthifolius\", # Scarlet bugler\n    \"GRICAM\" ~ \"Grindelia camporum\", # Gumweed\n    \"SALLEU\" ~ \"Salvia leucophylla\", # purple sage\n    \"STIPUL\" ~ \"Stipa pulchra\", # purple needlegrass\n    \"LOTSCO\" ~ \"Lotus scoparius\" # deerweed\n  )) |> \n  # making a column of full drought treatment names\n  mutate(water_treatment = case_match(\n    water,\n    \"WW\" ~ \"Well watered\",\n    \"DS\" ~ \"Drought stressed\"\n  )) |> \n  # making sure that species_name is a factor and ordering levels\n  mutate(species_name = as_factor(species_name),\n         species_name = fct_relevel(species_name,\n                                    \"Lotus scoparius\",\n                                    \"Penstemon centranthifolius\",\n                                    \"Salvia leucophylla\",\n                                    \"Encelia californica\",\n                                    \"Stipa pulchra\",\n                                    \"Eschscholzia californica\",\n                                    \"Grindelia camporum\")) |> \n  # making sure that water_treatment is a factor and ordering levels\n  mutate(water_treatment = as_factor(water_treatment),\n         water_treatment = fct_relevel(water_treatment,\n                                       \"Drought stressed\",\n                                       \"Well watered\")) |> \n  # selecting columns\n  select(species_name, water_treatment, sla, total_g)\n```\n:::\n\n\n\nDouble checking that everything worked by checking the structure:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(drought_exp_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [70 × 4] (S3: tbl_df/tbl/data.frame)\n $ species_name   : Factor w/ 7 levels \"Lotus scoparius\",..: 4 4 4 4 4 4 4 4 4 4 ...\n $ water_treatment: Factor w/ 2 levels \"Drought stressed\",..: 2 2 2 2 2 1 1 1 1 1 ...\n $ sla            : num [1:70] 170 215 209 216 222 ...\n $ total_g        : num [1:70] 0.455 0.329 0.45 0.359 0.352 ...\n```\n\n\n:::\n:::\n\n\n\nAnd displaying some rows from the data frame:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslice_sample(\n  drought_exp_clean, # data frame\n  n = 10 # showing 10 rows\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 4\n   species_name               water_treatment    sla total_g\n   <fct>                      <fct>            <dbl>   <dbl>\n 1 Encelia californica        Well watered      209.   0.450\n 2 Stipa pulchra              Drought stressed  176.   0.181\n 3 Penstemon centranthifolius Well watered      160.   0.172\n 4 Lotus scoparius            Drought stressed  107.   0.159\n 5 Stipa pulchra              Drought stressed  146.   0.246\n 6 Lotus scoparius            Well watered      123.   0.182\n 7 Penstemon centranthifolius Well watered      165.   0.197\n 8 Encelia californica        Drought stressed  171.   0.259\n 9 Penstemon centranthifolius Well watered      129.   0.220\n10 Stipa pulchra              Well watered      159.   0.353\n```\n\n\n:::\n:::\n\n\n\n\n### 3. Visualizing data\n\nThis code hopes to answer the question, what is the relationship between SLA and total mass?  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base layer: ggplot\nggplot(data = drought_exp_clean,\n       aes(x = sla,\n           y = total_g)) +\n  # scatter plot\n  geom_point() +\n  # relabeling axes and adding a title\n  labs(x = expression(Specific~leaf~area~(cm^2/g)),\n       y = \"Total mass (g)\",\n       title = \"As SLA increases, total mass increases\")\n```\n\n::: {.cell-output-display}\n![](workshop_files/figure-html/sla-1.png){width=960}\n:::\n:::\n\n\n\nWhat are the differences in total mass between water treatments?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base layer: ggplot\nggplot(data = drought_exp_clean,\n       aes(x = water_treatment,\n           y = total_g,\n           color = water_treatment)) +\n  # first layer: jitter\n  geom_jitter(width = 0.1,\n              height = 0,\n              shape = 21,\n              alpha = 0.6) +\n  # adding a summary to calculate mean mass in each water treatment\n  stat_summary(geom = \"point\",\n               fun = mean,\n               size = 4) +\n  # manually setting colors\n  scale_color_manual(values = c(\"Well watered\" = ww_col,\n                                \"Drought stressed\" = ds_col)) +\n  # changing axis labels and title\n  labs(x = \"Water treatment\",\n       y = \"Total mass (g)\",\n       title = \"Average total mass is higher in well-watered treatment than drought stressed treatment\") +\n  # taking out legend\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](workshop_files/figure-html/water-treatment-1.png){width=960}\n:::\n:::\n\n\n\nWhat are the differences in total mass between species?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base layer: ggplot\nggplot(data = drought_exp_clean,\n       aes(x = species_name,\n           y = total_g,\n           color = species_name)) +\n  # first layer: jitter\n  geom_jitter(width = 0.1,\n              height = 0,\n              shape = 21,\n              alpha = 0.6) +\n  # summary to calculate mean mass for each species\n  stat_summary(geom = \"point\",\n               fun = mean,\n               size = 4) +\n  # making sure that axis labels wrap nicely\n  scale_x_discrete(labels = label_wrap(10)) +\n  # setting colors manually\n  scale_color_manual(values = c(\n    \"Lotus scoparius\" = lotsco_col,\n    \"Penstemon centranthifolius\" = pencen_col,\n    \"Salvia leucophylla\" = salleu_col,\n    \"Encelia californica\" = enccal_col,\n    \"Stipa pulchra\" = stipul_col,\n    \"Eschscholzia californica\" = esccal_col,\n    \"Grindelia camporum\" = gricam_col\n  )) +\n  # labelling axes and title\n  labs(x = \"Species\",\n       y = \"Total mass (g)\",\n       title = \"Species differ in mean mass\") +\n  # getting rid of legend\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](workshop_files/figure-html/species-1.png){width=960}\n:::\n:::\n\n\n\n### 4. Fitting models\n\n8 models total:\n\n| Model number | SLA | Water treatment | Species | Predictor list              |  \n|:------------:|:---:|:---------------:|:-------:|-----------------------------|  \n| 0            |     |                 |         | no predictors (null model)  |\n| 1            |  X  |       X         |    X    | all predictors (full model) | \n| 2            |  X  |       X         |         | SLA and water treatment     |   \n| 3            |  X  |                 |    X    | SLA and species             |    \n| 4            |     |       X         |    X    | water treatment and species |    \n| 5            |  X  |                 |         | SLA                         |    \n| 6            |     |       X         |         | water treatment             |    \n| 7            |     |                 |    X    | species                     |\n\nModel fitting\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# model 0: null model\nmodel0 <- lm(\n  total_g ~ 1, # formula\n  data = drought_exp_clean # data frame\n)\n\n# model 1: all predictors\nmodel1 <- lm(\n  total_g ~ sla + water_treatment + species_name, # formula\n  data = drought_exp_clean # data frame\n)\n\n# model 2: SLA and water treatment\nmodel2 <- lm(\n  total_g ~ sla + water_treatment,\n  data = drought_exp_clean\n)\n\n# model 3: SLA and species\nmodel3 <- lm(\n  total_g ~ sla + species_name,\n  data = drought_exp_clean\n)\n\n# model 4: water treatment and species\nmodel4 <- lm(\n  total_g ~ water_treatment + species_name,\n  data = drought_exp_clean\n)\n\n# model 5: SLA\nmodel5 <- lm(total_g ~ sla,\n             data = drought_exp_clean)\n\n# model 6: water treatment\nmodel6 <- lm(total_g ~ water_treatment,\n             data = drought_exp_clean)\n\n# model 7: species\nmodel7 <- lm(total_g ~ species_name,\n             data = drought_exp_clean)\n```\n:::\n\n\n\nModel selection \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAICc(model1,\n     model2,\n     model3,\n     model4, # best model: water and species\n     model5,\n     model6,\n     model7,\n     model0) |> \n  # arranging output in descending order of AIC, model with lowest number is the best. \n  arrange(AICc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       df       AICc\nmodel4  9 -156.19595\nmodel1 10 -153.75361\nmodel3  9 -124.07569\nmodel7  8 -120.30191\nmodel2  4  -95.82521\nmodel5  3  -88.85180\nmodel6  3  -86.76661\nmodel0  2  -74.98036\n```\n\n\n:::\n:::\n\n\nIn this, the model with the lowest integer output is the best fit. We then run model diagnostics to see if the residuals are okay and normally distributed. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(2,2))\nplot(model4) # residuals look ok for best model. \n```\n\n::: {.cell-output-display}\n![](workshop_files/figure-html/model-diagnostics-1.png){width=672}\n:::\n:::\n\n\nBecause the residuals look okay, we moved on here. If not, we would plot the next best model (model 1), etc until we found the actual best fit model. \n\n\nModel selection\n\n\nLook at the model summary:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(model4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = total_g ~ water_treatment + species_name, data = drought_exp_clean)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.157087 -0.046953 -0.003733  0.041244  0.192657 \n\nCoefficients:\n                                       Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                             0.05455    0.02451   2.225  0.02973 *  \nwater_treatmentWell watered             0.11695    0.01733   6.746 5.90e-09 ***\nspecies_namePenstemon centranthifolius  0.05003    0.03243   1.543  0.12799    \nspecies_nameSalvia leucophylla          0.12020    0.03243   3.706  0.00045 ***\nspecies_nameEncelia californica         0.21774    0.03243   6.714 6.70e-09 ***\nspecies_nameStipa pulchra               0.22881    0.03243   7.055 1.72e-09 ***\nspecies_nameEschscholzia californica    0.23164    0.03243   7.143 1.22e-09 ***\nspecies_nameGrindelia camporum          0.31335    0.03243   9.662 5.53e-14 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.07252 on 62 degrees of freedom\nMultiple R-squared:  0.7535,\tAdjusted R-squared:  0.7257 \nF-statistic: 27.08 on 7 and 62 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\n# reference level for water_treatment: Drought stressed\n# reference level for species: Lotus scoparius\n```\n:::\n\n\n\n**What is the best model?**\n\nThe best model that predicts total plant mass (g) includes water treatment and species (F(7, 62) = 27.08, p < 0.001, $\\alpha$ = 0.05), but not SLA.  \n\n**How much variation in the response (total mass, in grams) does this model explain?**\n\nThis model explained 73% (adjusted R^2^) of the variation in total mass.\n\n**How do we interpret the effects of the predictors on the response variable (again, total mass in grams)?**\n\nOn average, plant masses in drought stressed conditions were 0.12 $\\pm$ 0.04 g less than plant masses in well watered conditions across species.  \n\nAcross water treatments, all species have different (and higher) masses than _Lotus scoparius_ except _Penstemon centranthifolius_.\n\n### 5. Model predictions\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel4_predictions <- ggpredict(\n  model4, # model object\n  terms = c(\"species_name\", \"water_treatment\") # predictors\n) |> \n  # treating this like a regular data frame\n  # renaming the columns\n  rename(species_name = x,\n         water_treatment = group)\n```\n:::\n\n\n\n\n### 6. Final figure\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# base layer: ggplot\n# using the drought_exp_clean object\nggplot(data = drought_exp_clean,\n       aes(x = water_treatment,\n           y = total_g,\n           color = water_treatment)) +\n  # first layer: jitter showing individual observations\n  geom_jitter(width = 0.1,\n              height = 0,\n              shape = 21,\n              alpha = 0.6) +\n  # second layer: point range showing model predictions\n  # note that this is appropriate because there are only categorical predictors\n  # in the final model\n  geom_pointrange(data = model4_predictions,\n                  aes(y = predicted,\n                      ymin = conf.low,\n                      ymax = conf.high)) +\n  # manually setting colors\n  scale_color_manual(values = c(\"Well watered\" = ww_col,\n                                \"Drought stressed\" = ds_col)) +\n  # wrapping x-axis labels\n  scale_x_discrete(labels = label_wrap(10)) +\n  # creating different panels for each species\n  facet_wrap(~species_name, nrow = 1) +\n  # labelling x- and y-axis\n  labs(x = \"Water treatment\",\n       y = \"Total mass (g)\") +\n  # taking out the legend\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](workshop_files/figure-html/final-figure-1.png){width=1152}\n:::\n:::\n\n\n\nData source: Valliere, Justin; Zhang, Jacqueline; Sharifi, M.; Rundel, Philip (2019). Data from: Can we condition native plants to increase drought tolerance and improve restoration success? [Dataset]. Dryad. [https://doi.org/10.5061/dryad.v0861f7](https://doi.org/10.5061/dryad.v0861f7)  \n\nCode: An Bui created the template for this workshop, and Thuy-Tien Bui walked us through each step in class. \n\n\n",
    "supporting": [
      "workshop_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}